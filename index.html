<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Lista de Compras</title>
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/3081/3081820.png" type="image/png">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</head>
<body class="bg-gray-100 flex justify-center items-center min-h-screen p-2">
  <div class="bg-white shadow-lg rounded-2xl p-4 w-full max-w-sm">
    <h1 class="text-xl font-bold text-center mb-2">üõí Lista de Compras</h1>

    <!-- Tabela -->
    <table class="w-full text-xs border-collapse">
      <thead>
        <tr class="border-b bg-gray-50">
          <th class="text-left p-1 w-[50%]">Produto</th>
          <th class="text-left p-1 w-[20%]">Qtd</th>
          <th class="text-left p-1 w-[20%]">Valor</th>
          <th class="text-left p-1 w-[10%]">üóëÔ∏è</th>
        </tr>
      </thead>
      <tbody id="lista"></tbody>
    </table>

    <div class="flex justify-between items-center mt-3">
      <p class="text-sm font-semibold">Total: <span id="totalGeral" class="text-green-600">R$ 0,00</span></p>
    </div>

    <!-- Bot√µes -->
    <div class="grid grid-cols-5 gap-1 mt-3 text-xs">
      <button id="addItem" class="bg-blue-500 text-white rounded py-1 hover:bg-blue-600">+Item</button>
      <button id="btnSalvar" class="bg-green-500 text-white rounded py-1 hover:bg-green-600">Salvar</button>
      <button id="btnCarregar" class="bg-yellow-500 text-white rounded py-1 hover:bg-yellow-600">Carregar</button>
      <button id="btnPDF" class="bg-purple-500 text-white rounded py-1 hover:bg-purple-600">PDF</button>
      <button id="btnLimpar" class="bg-gray-400 text-white rounded py-1 hover:bg-gray-500">Limpar</button>
    </div>
  </div>

  <script>
    const lista = document.getElementById("lista");
    const totalGeralEl = document.getElementById("totalGeral");

    // === Fun√ß√µes principais ===

    function atualizarTotal() {
      let total = 0;
      lista.querySelectorAll("tr").forEach(linha => {
        const qtd = parseFloat(linha.querySelector(".qtd").value) || 0;
        const valor = parseFloat(linha.querySelector(".valor").value) || 0;
        total += qtd * valor;
      });
      totalGeralEl.textContent = `R$ ${total.toFixed(2).replace(".", ",")}`;
      salvarAuto();
    }

    function criarLinha(produto = "", qtd = "", valor = "") {
      const tr = document.createElement("tr");
      tr.className = "border-b";
      tr.innerHTML = `
        <td><input type="text" class="produto w-full border rounded p-1 text-xs" value="${produto}" placeholder="Produto"></td>
        <td><input type="number" class="qtd w-full border rounded p-1 text-xs" min="0" value="${qtd}"></td>
        <td><input type="number" class="valor w-full border rounded p-1 text-xs" min="0" step="0.01" value="${valor}"></td>
        <td class="text-center"><button class="remover bg-red-500 text-white rounded px-2 py-1 text-xs">X</button></td>
      `;
      lista.appendChild(tr);
    }

    // === Persist√™ncia autom√°tica ===

    function salvarAuto() {
      const dados = [];
      lista.querySelectorAll("tr").forEach(tr => {
        const produto = tr.querySelector(".produto").value.trim();
        const qtd = tr.querySelector(".qtd").value;
        const valor = tr.querySelector(".valor").value;
        if (produto || qtd || valor) dados.push({ produto, qtd, valor });
      });
      localStorage.setItem("listaComprasAuto", JSON.stringify(dados));
    }

    function carregarAuto() {
      const dados = localStorage.getItem("listaComprasAuto");
      if (dados) {
        const itens = JSON.parse(dados);
        lista.innerHTML = "";
        itens.forEach(item => criarLinha(item.produto, item.qtd, item.valor));
      } else {
        criarLinha();
      }
      atualizarTotal();
    }

    // === Exporta√ß√µes ===

    function salvarJSON() {
      const nomeArquivo = prompt("Digite o nome do arquivo para salvar:", "lista_compras");
      if (!nomeArquivo) return;
      const dados = JSON.parse(localStorage.getItem("listaComprasAuto") || "[]");
      const blob = new Blob([JSON.stringify(dados, null, 2)], { type: "application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = `${nomeArquivo}.json`;
      a.click();
    }

    function carregarJSON() {
      const input = document.createElement("input");
      input.type = "file";
      input.accept = ".json";
      input.onchange = e => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = event => {
          const dados = JSON.parse(event.target.result);
          lista.innerHTML = "";
          dados.forEach(item => criarLinha(item.produto, item.qtd, item.valor));
          atualizarTotal();
        };
        reader.readAsText(file);
      };
      input.click();
    }

    function exportarPDF() {
      const nomeArquivo = prompt("Digite o nome do arquivo PDF:", "lista_compras");
      if (!nomeArquivo) return;
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      const linhas = [];
      lista.querySelectorAll("tr").forEach(tr => {
        const produto = tr.querySelector(".produto").value.trim();
        const qtd = tr.querySelector(".qtd").value;
        const valor = tr.querySelector(".valor").value;
        if (produto) linhas.push([produto, qtd, valor]);
      });

      doc.text("Lista de Compras", 14, 10);
      doc.autoTable({
        head: [["Produto", "Quantidade", "Valor"]],
        body: linhas,
        startY: 15,
        styles: { fontSize: 10 },
        theme: 'grid'
      });
      doc.text(`Total: ${totalGeralEl.textContent}`, 14, doc.lastAutoTable.finalY + 10);
      doc.save(`${nomeArquivo}.pdf`);
    }

    // === Eventos ===

    document.getElementById("addItem").onclick = () => { criarLinha(); salvarAuto(); };
    document.getElementById("btnSalvar").onclick = salvarJSON;
    document.getElementById("btnCarregar").onclick = carregarJSON;
    document.getElementById("btnPDF").onclick = exportarPDF;
    document.getElementById("btnLimpar").onclick = () => {
      if (confirm("Deseja limpar toda a lista?")) {
        lista.innerHTML = "";
        criarLinha();
        atualizarTotal();
        localStorage.removeItem("listaComprasAuto");
      }
    };

    lista.addEventListener("click", e => {
      if (e.target.classList.contains("remover")) {
        if (confirm("Remover este item?")) {
          e.target.closest("tr").remove();
          atualizarTotal();
        }
      }
    });

    lista.addEventListener("input", atualizarTotal);

    // === Inicializa√ß√£o autom√°tica ===
    carregarAuto();
  </script>
</body>
</html>
